<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASK+ Parametrik | Admin Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            DEFAULT: '#1e3a8a',
                            dark: '#1e293b',
                            light: '#3b82f6'
                        },
                        secondary: '#10b981',
                        warning: '#f59e0b',
                        danger: '#dc2626',
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-hidden {
            transform: translateX(-100%);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc2626;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
        }
        
        @keyframes pulse-red {
            0%,
            100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .pulse-red {
            animation: pulse-red 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>

<body class="bg-gray-100 font-sans">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-primary-dark text-white transform transition-transform duration-300 ease-in-out lg:translate-x-0 sidebar-hidden">
            <div class="flex items-center justify-center h-16 border-b border-gray-700">
                <img src="/static/logo.png" alt="Logo" class="h-8 w-auto mr-3 filter brightness-0 invert">
                <h1 class="text-xl font-bold">DASK+ Admin</h1>
            </div>
            <nav class="mt-5 px-2 space-y-1">
                <a href="#dashboard" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md bg-primary">
                    <i class="fas fa-tachometer-alt mr-3"></i> Dashboard
                </a>
                <a href="#policies" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-primary">
                    <i class="fas fa-file-contract mr-3"></i> Poliçe Yönetimi
                </a>
                <a href="#claims" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-primary relative">
                    <i class="fas fa-exclamation-circle mr-3"></i> Hasar Yönetimi
                    <span class="notification-badge">3</span>
                </a>
                <a href="#customers" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-primary">
                    <i class="fas fa-users mr-3"></i> Müşteri Yönetimi
                </a>
                <a href="#parametric" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-primary">
                    <i class="fas fa-cogs mr-3"></i> Parametrik Ayarlar
                </a>
                <a href="#payments" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-primary">
                    <i class="fas fa-credit-card mr-3"></i> Ödeme İşlemleri
                </a>
                <a href="#reports" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-primary">
                    <i class="fas fa-chart-line mr-3"></i> Raporlar & Analiz
                </a>
                <a href="#notifications" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-primary relative">
                    <i class="fas fa-bell mr-3"></i> Bildirimler
                    <span class="notification-badge">7</span>
                </a>
                <a href="#integrations" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-primary">
                    <i class="fas fa-plug mr-3"></i> Entegrasyonlar
                </a>
                <a href="#audit" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-primary">
                    <i class="fas fa-history mr-3"></i> Denetim Kayıtları
                </a>
                <a href="#settings" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-primary">
                    <i class="fas fa-sliders-h mr-3"></i> Sistem Ayarları
                </a>
            </nav>

            <div class="absolute bottom-0 w-full p-4 border-t border-gray-700">
                <button class="w-full flex items-center justify-center px-3 py-2 text-sm font-medium rounded-md bg-red-600 hover:bg-red-700 transition-colors">
                    <i class="fas fa-sign-out-alt mr-2"></i> Çıkış Yap
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden lg:ml-64">
            <header class="bg-white shadow-sm border-b">
                <div class="mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                    <button id="sidebar-toggle" class="lg:hidden text-gray-500 hover:text-gray-700">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h2 id="page-title" class="text-2xl font-bold text-gray-900">Dashboard</h2>
                    <div class="flex items-center space-x-4">
                        <!-- Notification Bell -->
                        <button class="relative text-gray-500 hover:text-gray-700">
                            <i class="fas fa-bell text-xl"></i>
                            <span class="notification-badge">7</span>
                        </button>
                        <!-- User Profile -->
                        <div class="flex items-center space-x-2">
                            <img class="h-9 w-9 rounded-full" src="https://ui-avatars.com/api/?name=Admin&background=1e3a8a&color=ffffff" alt="Admin">
                            <span class="text-sm font-medium text-gray-700 hidden sm:block">Admin User</span>
                        </div>
                    </div>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto bg-gray-50 p-6">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="section active fade-in">
                    <!-- Quick Actions -->
                    <div class="mb-6 flex flex-wrap gap-3">
                        <button class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            <i class="fas fa-plus mr-2"></i>Yeni Poliçe Oluştur
                        </button>
                        <button class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium border transition-colors">
                            <i class="fas fa-file-export mr-2"></i>Rapor İndir
                        </button>
                        <button class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium border transition-colors">
                            <i class="fas fa-sync mr-2"></i>Verileri Yenile
                        </button>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <!-- Stats Cards -->
                        <div class="bg-white p-5 shadow rounded-lg transition-all duration-300 stat-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">Aktif Poliçeler</p>
                                    <p id="stat-policies" class="text-3xl font-bold text-gray-900 mt-2">1,247</p>
                                    <p class="text-xs text-green-600 mt-1"><i class="fas fa-arrow-up"></i> %12.5 bu ay</p>
                                </div>
                                <i class="fas fa-file-alt text-3xl text-primary-light"></i>
                            </div>
                        </div>
                        <div class="bg-white p-5 shadow rounded-lg transition-all duration-300 stat-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">Tetiklenen Ödemeler (24s)</p>
                                    <p id="stat-claims" class="text-3xl font-bold text-gray-900 mt-2">12</p>
                                    <p class="text-xs text-orange-600 mt-1"><i class="fas fa-exclamation-triangle"></i> 3 beklemede</p>
                                </div>
                                <i class="fas fa-exclamation-triangle text-3xl text-warning"></i>
                            </div>
                        </div>
                        <div class="bg-white p-5 shadow rounded-lg transition-all duration-300 stat-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">Aylık Prim Geliri</p>
                                    <p id="stat-revenue" class="text-3xl font-bold text-gray-900 mt-2">₺2.8M</p>
                                    <p class="text-xs text-green-600 mt-1"><i class="fas fa-arrow-up"></i> %8.3 artış</p>
                                </div>
                                <i class="fas fa-lira-sign text-3xl text-secondary"></i>
                            </div>
                        </div>
                        <div class="bg-white p-5 shadow rounded-lg transition-all duration-300 stat-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">Yüksek Riskli Poliçeler</p>
                                    <p id="stat-high-risk" class="text-3xl font-bold text-gray-900 mt-2">315</p>
                                    <p class="text-xs text-red-600 mt-1"><i class="fas fa-exclamation"></i> Dikkat gerekli</p>
                                </div>
                                <i class="fas fa-tachometer-alt text-3xl text-danger"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Stats Row -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-5 shadow rounded-lg text-white">
                            <p class="text-sm font-medium opacity-90">Toplam Müşteri</p>
                            <p class="text-3xl font-bold mt-2" id="stat-total-customers">-</p>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 p-5 shadow rounded-lg text-white">
                            <p class="text-sm font-medium opacity-90">Ortalama Poliçe Değeri</p>
                            <p class="text-3xl font-bold mt-2">₺48,500</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-5 shadow rounded-lg text-white">
                            <p class="text-sm font-medium opacity-90">Müşteri Memnuniyeti</p>
                            <p class="text-3xl font-bold mt-2">4.8/5.0</p>
                        </div>
                        <div class="bg-gradient-to-br from-orange-500 to-orange-600 p-5 shadow rounded-lg text-white">
                            <p class="text-sm font-medium opacity-90">Hasar Ödeme Oranı</p>
                            <p class="text-3xl font-bold mt-2">%98.2</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="lg:col-span-2 bg-white shadow rounded-lg p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Poliçe Büyümesi (Son 6 Ay)</h3>
                                <select class="text-sm border rounded px-3 py-1">
                                    <option>Son 6 Ay</option>
                                    <option>Son 1 Yıl</option>
                                    <option>Tüm Zamanlar</option>
                                </select>
                            </div>
                            <div class="chart-container"><canvas id="policyGrowthChart"></canvas></div>
                        </div>
                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Risk Dağılımı</h3>
                            <div class="chart-container"><canvas id="riskDistributionChart"></canvas></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Live PGV Monitor -->
                        <div class="bg-white shadow rounded-lg p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Canlı PGV Monitörü (cm/s)</h3>
                                <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Aktif İzleme</span>
                            </div>
                            <div id="pgv-monitor" class="space-y-3"></div>
                        </div>
                        <!-- Live Earthquake Feed -->
                        <div class="bg-white shadow rounded-lg p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Son Depremler (>2.0 ML)</h3>
                                <span class="text-xs text-green-600 bg-green-50 px-2 py-1 rounded-full">
                                    <i class="fas fa-satellite-dish mr-1"></i>Kandilli Canlı Veri
                                </span>
                            </div>
                            <div id="earthquake-feed" class="space-y-3 overflow-y-auto" style="max-height: 360px;"></div>
                        </div>
                    </div>

                    <!-- Recent Activities -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Son Aktiviteler</h3>
                        <div class="space-y-3" id="recentActivities"></div>
                    </div>
                </div>

                <!-- Policy Management Section -->
                <div id="policies-section" class="section hidden fade-in">
                    <div class="bg-white shadow rounded-lg">
                        <div class="p-4 border-b flex justify-between items-center flex-wrap gap-3">
                            <h3 class="text-lg font-semibold">Poliçe Listesi</h3>
                            <div class="flex items-center space-x-2 flex-wrap gap-2">
                                <input type="text" id="policySearch" placeholder="Poliçe veya Müşteri Ara..." class="px-3 py-1.5 border rounded-md text-sm">
                                <select id="policyFilter" class="px-3 py-1.5 border rounded-md text-sm">
                                    <option value="all">Tümü</option>
                                    <option value="Aktif">Aktif</option>
                                    <option value="Beklemede">Beklemede</option>
                                    <option value="Süresi Doldu">Süresi Doldu</option>
                                </select>
                                <button class="bg-primary text-white px-4 py-1.5 rounded-md text-sm hover:bg-primary-dark">
                                    <i class="fas fa-download mr-1"></i>Excel İndir
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Poliçe No</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Müşteri</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Adres</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Teminat</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Prim</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Başlangıç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Durum</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">İşlemler</th>
                                    </tr>
                                </thead>
                                <tbody id="policyTableBody" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                        <div class="p-4 border-t flex justify-between items-center">
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-600">Sayfa başına göster:</span>
                                <select id="policyPerPageSelect" class="border rounded-md px-3 py-1.5 text-sm font-medium bg-white">
                                    <option value="10">10</option>
                                    <option value="20" selected>20</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <span class="text-sm text-gray-600 ml-4">Toplam: <span id="totalPolicies">0</span> poliçe</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="policyPrevPageBtn" class="px-3 py-1.5 border rounded-md text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    <i class="fas fa-chevron-left mr-1"></i>Önceki
                                </button>
                                <div id="policyPageNumbers" class="flex items-center space-x-1"></div>
                                <button id="policyNextPageBtn" class="px-3 py-1.5 border rounded-md text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    Sonraki<i class="fas fa-chevron-right ml-1"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Claims Management Section -->
                <div id="claims-section" class="section hidden fade-in">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white p-5 shadow rounded-lg">
                            <p class="text-sm font-medium text-gray-500">Aktif Hasar Talepleri</p>
                            <p class="text-3xl font-bold text-orange-600 mt-2">12</p>
                        </div>
                        <div class="bg-white p-5 shadow rounded-lg">
                            <p class="text-sm font-medium text-gray-500">Bekleyen Ödemeler</p>
                            <p class="text-3xl font-bold text-yellow-600 mt-2">3</p>
                        </div>
                        <div class="bg-white p-5 shadow rounded-lg">
                            <p class="text-sm font-medium text-gray-500">Tamamlanan (Bu Ay)</p>
                            <p class="text-3xl font-bold text-green-600 mt-2">45</p>
                        </div>
                    </div>

                    <div class="bg-white shadow rounded-lg">
                        <div class="p-4 border-b">
                            <h3 class="text-lg font-semibold">Hasar Talepleri</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hasar No</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Poliçe No</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Müşteri</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Deprem Tarihi</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">PGV Değeri</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ödeme Tutarı</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Durum</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">İşlem</th>
                                    </tr>
                                </thead>
                                <tbody id="claimsTableBody" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Customer Management Section -->
                <div id="customers-section" class="section hidden fade-in">
                    <div class="bg-white shadow rounded-lg p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Müşteri Listesi</h3>
                            <div class="flex space-x-2 items-center">
                                <input type="text" id="customersSearch" placeholder="Müşteri Ara..." class="px-3 py-1.5 border rounded-md text-sm">
                                <button class="bg-primary text-white px-4 py-1.5 rounded-md text-sm hover:bg-primary-dark">
                                    <i class="fas fa-user-plus mr-1"></i>Yeni Müşteri
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Müşteri ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ad Soyad</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">E-posta</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Telefon</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Poliçe Sayısı</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Kayıt Tarihi</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">İşlemler</th>
                                    </tr>
                                </thead>
                                <tbody id="customersTableBody" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>

                        <!-- Pagination Footer -->
                        <div class="flex justify-between items-center mt-6 pt-4 border-t">
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-600">Sayfa başına göster:</span>
                                <select id="perPageSelect" class="border rounded-md px-3 py-1.5 text-sm font-medium bg-white">
                                    <option value="20">20</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <span class="text-sm text-gray-600 ml-4">Toplam: <span id="totalCustomers">0</span> müşteri</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="prevPageBtn" class="px-3 py-1.5 border rounded-md text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    <i class="fas fa-chevron-left mr-1"></i>Önceki
                                </button>
                                <div id="pageNumbers" class="flex items-center space-x-1"></div>
                                <button id="nextPageBtn" class="px-3 py-1.5 border rounded-md text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    Sonraki<i class="fas fa-chevron-right ml-1"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer Detail Modal -->
                <div id="customerDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-y-auto">
                    <div class="flex items-center justify-center min-h-screen p-4">
                        <div class="bg-white rounded-lg shadow-lg max-w-4xl w-full max-h-96 overflow-y-auto">
                            <!-- Modal Header -->
                            <div class="sticky top-0 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-4 flex justify-between items-center">
                                <h2 id="modalCustomerName" class="text-2xl font-bold">Müşteri Detayları</h2>
                                <button onclick="closeCustomerModal()" class="text-white hover:text-gray-200 text-2xl">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>

                            <!-- Modal Body -->
                            <div class="p-6 space-y-6">
                                <!-- Kişisel Bilgiler -->
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                        <i class="fas fa-user text-blue-600 mr-2"></i>Kişisel Bilgiler
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Ad Soyad</p>
                                            <p id="modalAdSoyad" class="text-gray-900 font-semibold">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">TC Kimlik No</p>
                                            <p id="modalTcNo" class="text-gray-900 font-semibold">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">E-posta</p>
                                            <p id="modalEmail" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Telefon</p>
                                            <p id="modalTelefon" class="text-gray-900">-</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Adres Bilgileri -->
                                <div class="border-t pt-4">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                        <i class="fas fa-map-marker-alt text-blue-600 mr-2"></i>Adres Bilgileri
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">İlçe</p>
                                            <p id="modalIlce" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Semte</p>
                                            <p id="modalSemte" class="text-gray-900">-</p>
                                        </div>
                                        <div class="md:col-span-2">
                                            <p class="text-sm font-medium text-gray-600">Tam Adres</p>
                                            <p id="modalTamAdres" class="text-gray-900 text-sm">-</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Bina Bilgileri -->
                                <div class="border-t pt-4">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                        <i class="fas fa-building text-blue-600 mr-2"></i>Bina Bilgileri
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Yapı Tipi</p>
                                            <p id="modalYapiTipi" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">İnşa Yılı</p>
                                            <p id="modalInsaYili" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Bina Yaşı</p>
                                            <p id="modalBinaYasi" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Kat Sayısı</p>
                                            <p id="modalKatSayisi" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Daire Sayısı</p>
                                            <p id="modalDaireSayisi" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Bina Alanı (m²)</p>
                                            <p id="modalBinaAlani" class="text-gray-900">-</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Risk Bilgileri -->
                                <div class="border-t pt-4">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                        <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>Risk Analizi
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Zemin Tipi</p>
                                            <p id="modalZeminTipi" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Zemin Amplifikasyonu</p>
                                            <p id="modalZeminAmplifikasyonu" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Likefaksiyon Riski</p>
                                            <p id="modalLikefaksiyonRiski" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">En Yakın Fay</p>
                                            <p id="modalEnYakinFay" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Faya Uzaklık (km)</p>
                                            <p id="modalFayaUzaklik" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Risk Skoru</p>
                                            <p id="modalRiskSkoru" class="text-gray-900 font-bold">-</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Sigorta Bilgileri -->
                                <div class="border-t pt-4">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                        <i class="fas fa-shield-alt text-green-600 mr-2"></i>Sigorta Bilgileri
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Paket Tipi</p>
                                            <p id="modalPaketTipi" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Max Teminat (TL)</p>
                                            <p id="modalMaxTeminat" class="text-gray-900 font-semibold">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Yıllık Prim (TL)</p>
                                            <p id="modalYillikPrim" class="text-gray-900 font-semibold">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Aylık Prim (TL)</p>
                                            <p id="modalAylikPrim" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Poliçe Durumu</p>
                                            <p id="modalPoliceDurumu" class="text-gray-900">-</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Toplam Poliçeler</p>
                                            <p id="modalToplamPolice" class="text-gray-900 font-semibold">-</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Parametric Settings Section -->
                <div id="parametric-section" class="section hidden fade-in">
                    <div class="bg-white shadow rounded-lg p-6 mb-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-6">Parametrik Tetikleyici Ayarları</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div class="space-y-4 p-4 border-2 border-red-200 rounded-lg bg-red-50">
                                <h4 class="font-bold text-lg text-danger flex items-center">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>Yüksek Risk Bölgesi
                                </h4>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">PGV Eşiği (cm/s)</label>
                                    <input type="number" value="20" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-danger">
                                    <p class="text-xs text-gray-500 mt-1">İstanbul, İzmir gibi yüksek risk bölgeleri</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ödeme Tutarı (TL)</label>
                                    <input type="number" value="50000" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-warning">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Yıllık Prim Katsayısı</label>
                                    <input type="number" step="0.1" value="1.5" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-warning">
                                </div>
                            </div>

                            <div class="space-y-4 p-4 border-2 border-green-200 rounded-lg bg-green-50">
                                <h4 class="font-bold text-lg text-secondary flex items-center">
                                    <i class="fas fa-check-circle mr-2"></i>Düşük Risk Bölgesi
                                </h4>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">PGV Eşiği (cm/s)</label>
                                    <input type="number" value="40" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-secondary">
                                    <p class="text-xs text-gray-500 mt-1">Ankara gibi düşük risk bölgeleri</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ödeme Tutarı (TL)</label>
                                    <input type="number" value="25000" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-secondary">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Yıllık Prim Katsayısı</label>
                                    <input type="number" step="0.1" value="1.0" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-secondary">
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 flex justify-between items-center">
                            <button class="text-sm text-gray-600 hover:text-gray-800">
                                <i class="fas fa-undo mr-1"></i>Varsayılana Dön
                            </button>
                            <button class="bg-primary hover:bg-primary-dark text-white font-bold py-2 px-6 rounded-lg transition-colors">
                                <i class="fas fa-save mr-2"></i>Ayarları Kaydet
                            </button>
                        </div>
                    </div>

                    <!-- Veri Kaynağı Durumu -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Veri Kaynağı Durumu</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-check-circle text-green-600 text-2xl mr-3"></i>
                                        <div>
                                            <p class="font-medium text-gray-800">Kandilli Rasathanesi API</p>
                                            <p class="text-xs text-gray-500">Son güncelleme: 2 dakika önce</p>
                                        </div>
                                    </div>
                                    <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Aktif</span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-check-circle text-green-600 text-2xl mr-3"></i>
                                        <div>
                                            <p class="font-medium text-gray-800">AFAD API</p>
                                            <p class="text-xs text-gray-500">Son güncelleme: 1 dakika önce</p>
                                        </div>
                                    </div>
                                    <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Aktif</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Otomatik Tetikleme Ayarları</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Otomatik SMS Bildirimi</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" checked class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Otomatik E-posta Bildirimi</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" checked class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Otomatik Ödeme Onayı</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Admin Bildirimleri</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" checked class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payments Section -->
                <div id="payments-section" class="section hidden fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white p-5 shadow rounded-lg">
                            <p class="text-sm font-medium text-gray-500">Bu Ay Toplam Ödeme</p>
                            <p class="text-3xl font-bold text-gray-900 mt-2">₺1.85M</p>
                        </div>
                        <div class="bg-white p-5 shadow rounded-lg">
                            <p class="text-sm font-medium text-gray-500">Bekleyen Ödemeler</p>
                            <p class="text-3xl font-bold text-yellow-600 mt-2">₺225K</p>
                        </div>
                        <div class="bg-white p-5 shadow rounded-lg">
                            <p class="text-sm font-medium text-gray-500">Başarısız Ödemeler</p>
                            <p class="text-3xl font-bold text-red-600 mt-2">2</p>
                        </div>
                    </div>

                    <div class="bg-white shadow rounded-lg">
                        <div class="p-4 border-b">
                            <h3 class="text-lg font-semibold">Ödeme İşlemleri</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">İşlem ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Poliçe No</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Müşteri</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tutar</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tarih</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Durum</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">İşlem</th>
                                    </tr>
                                </thead>
                                <tbody id="paymentsTableBody" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reports-section" class="section hidden fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                        <button class="bg-white p-6 shadow rounded-lg hover:shadow-lg transition-shadow text-left">
                            <i class="fas fa-file-pdf text-4xl text-red-500 mb-3"></i>
                            <h4 class="font-semibold text-gray-900">Aylık Poliçe Raporu</h4>
                            <p class="text-sm text-gray-500 mt-2">Detaylı poliçe analizi ve istatistikler</p>
                        </button>
                        <button class="bg-white p-6 shadow rounded-lg hover:shadow-lg transition-shadow text-left">
                            <i class="fas fa-file-excel text-4xl text-green-600 mb-3"></i>
                            <h4 class="font-semibold text-gray-900">Finansal Özet Raporu</h4>
                            <p class="text-sm text-gray-500 mt-2">Gelir, gider ve karlılık analizi</p>
                        </button>
                        <button class="bg-white p-6 shadow rounded-lg hover:shadow-lg transition-shadow text-left">
                            <i class="fas fa-chart-bar text-4xl text-blue-500 mb-3"></i>
                            <h4 class="font-semibold text-gray-900">Risk Analiz Raporu</h4>
                            <p class="text-sm text-gray-500 mt-2">Bölgesel risk dağılımı ve hasar analizi</p>
                        </button>
                        <button class="bg-white p-6 shadow rounded-lg hover:shadow-lg transition-shadow text-left">
                            <i class="fas fa-users text-4xl text-purple-500 mb-3"></i>
                            <h4 class="font-semibold text-gray-900">Müşteri Analiz Raporu</h4>
                            <p class="text-sm text-gray-500 mt-2">Müşteri davranışları ve segmentasyon</p>
                        </button>
                        <button class="bg-white p-6 shadow rounded-lg hover:shadow-lg transition-shadow text-left">
                            <i class="fas fa-clock text-4xl text-orange-500 mb-3"></i>
                            <h4 class="font-semibold text-gray-900">Ödeme Hız Raporu</h4>
                            <p class="text-sm text-gray-500 mt-2">Tetikleme ve ödeme süre analizi</p>
                        </button>
                        <button class="bg-white p-6 shadow rounded-lg hover:shadow-lg transition-shadow text-left">
                            <i class="fas fa-globe text-4xl text-teal-500 mb-3"></i>
                            <h4 class="font-semibold text-gray-900">Coğrafi Dağılım Raporu</h4>
                            <p class="text-sm text-gray-500 mt-2">İl ve ilçe bazlı poliçe dağılımı</p>
                        </button>
                    </div>

                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Özel Rapor Oluştur</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Rapor Türü</label>
                                <select class="w-full px-3 py-2 border rounded-md">
                                    <option>Poliçe Raporu</option>
                                    <option>Finansal Rapor</option>
                                    <option>Hasar Raporu</option>
                                    <option>Müşteri Raporu</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tarih Aralığı</label>
                                <select class="w-full px-3 py-2 border rounded-md">
                                    <option>Son 7 Gün</option>
                                    <option>Son 30 Gün</option>
                                    <option>Son 3 Ay</option>
                                    <option>Son 1 Yıl</option>
                                    <option>Özel Aralık</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-4 text-right">
                            <button class="bg-primary hover:bg-primary-dark text-white px-6 py-2 rounded-lg transition-colors">
                                <i class="fas fa-download mr-2"></i>Rapor Oluştur
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Notifications Section -->
                <div id="notifications-section" class="section hidden fade-in">
                    <div class="bg-white shadow rounded-lg">
                        <div class="p-4 border-b">
                            <h3 class="text-lg font-semibold">Sistem Bildirimleri</h3>
                        </div>
                        <div class="divide-y" id="notificationsList"></div>
                    </div>
                </div>

                <!-- Integrations Section -->
                <div id="integrations-section" class="section hidden fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white shadow rounded-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <i class="fas fa-university text-3xl text-blue-600 mr-3"></i>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">Banka Entegrasyonu</h4>
                                        <p class="text-sm text-gray-500">Otomatik ödeme işlemleri</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Aktif</span>
                            </div>
                            <button class="text-sm text-primary hover:text-primary-dark">Ayarları Düzenle</button>
                        </div>

                        <div class="bg-white shadow rounded-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <i class="fas fa-sms text-3xl text-green-600 mr-3"></i>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">SMS Gateway</h4>
                                        <p class="text-sm text-gray-500">Müşteri bildirimleri</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Aktif</span>
                            </div>
                            <button class="text-sm text-primary hover:text-primary-dark">Ayarları Düzenle</button>
                        </div>

                        <div class="bg-white shadow rounded-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <i class="fas fa-envelope text-3xl text-red-600 mr-3"></i>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">E-posta Servisi</h4>
                                        <p class="text-sm text-gray-500">Otomatik e-posta gönderimi</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Aktif</span>
                            </div>
                            <button class="text-sm text-primary hover:text-primary-dark">Ayarları Düzenle</button>
                        </div>

                        <div class="bg-white shadow rounded-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <i class="fas fa-database text-3xl text-purple-600 mr-3"></i>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">Reasürans API</h4>
                                        <p class="text-sm text-gray-500">Risk paylaşımı</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded-full">Yapılandırılıyor</span>
                            </div>
                            <button class="text-sm text-primary hover:text-primary-dark">Ayarları Düzenle</button>
                        </div>
                    </div>
                </div>

                <!-- Audit Logs Section -->
                <div id="audit-section" class="section hidden fade-in">
                    <div class="bg-white shadow rounded-lg">
                        <div class="p-4 border-b flex justify-between items-center">
                            <h3 class="text-lg font-semibold">Denetim Kayıtları</h3>
                            <div class="flex space-x-2">
                                <input type="date" class="px-3 py-1.5 border rounded-md text-sm">
                                <select class="px-3 py-1.5 border rounded-md text-sm">
                                    <option>Tüm İşlemler</option>
                                    <option>Poliçe İşlemleri</option>
                                    <option>Ödeme İşlemleri</option>
                                    <option>Sistem Ayarları</option>
                                </select>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tarih/Saat</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Kullanıcı</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">İşlem</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Detay</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">IP Adresi</th>
                                    </tr>
                                </thead>
                                <tbody id="auditTableBody" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- System Settings Section -->
                <div id="settings-section" class="section hidden fade-in">
                    <div class="grid grid-cols-1 gap-6">
                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Genel Ayarlar</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Şirket Adı</label>
                                    <input type="text" value="DASK+ Parametrik Sigorta A.Ş." class="w-full px-3 py-2 border rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">İletişim E-postası</label>
                                    <input type="email" value="info@daskplus.com.tr" class="w-full px-3 py-2 border rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Destek Telefonu</label>
                                    <input type="tel" value="444 3275" class="w-full px-3 py-2 border rounded-md">
                                </div>
                            </div>
                        </div>

                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Güvenlik Ayarları</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">İki Faktörlü Kimlik Doğrulama</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" checked class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Oturum Zaman Aşımı (dakika)</span>
                                    <input type="number" value="30" class="w-20 px-3 py-1 border rounded-md text-sm">
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">IP Kısıtlaması</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Kullanıcı Yönetimi</h3>
                            <button class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-user-plus mr-2"></i>Yeni Kullanıcı Ekle
                            </button>
                        </div>

                        <!-- AI Model Yönetimi -->
                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                                <i class="fas fa-brain mr-2 text-purple-600"></i>AI Model Yönetimi
                            </h3>

                            <div class="space-y-4">
                                <!-- Model Bilgileri -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-gray-700 mb-3">Mevcut Model Bilgileri</h4>
                                    <div id="model-info-container" class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Durum:</span>
                                            <span id="model-status" class="font-medium">Yükleniyor...</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Son Eğitim:</span>
                                            <span id="model-last-trained" class="font-medium">-</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">R² Score:</span>
                                            <span id="model-r2" class="font-medium">-</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">RMSE:</span>
                                            <span id="model-rmse" class="font-medium">-</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Eğitim Verileri:</span>
                                            <span id="model-samples" class="font-medium">-</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Model Aksiyonları -->
                                <div class="flex gap-3">
                                    <button id="btn-retrain-model" onclick="retrainModel()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors font-medium">
                                        <i class="fas fa-sync-alt mr-2"></i>Modeli Yeniden Eğit
                                    </button>
                                    <button onclick="loadModelInfo()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors">
                                        <i class="fas fa-refresh"></i>
                                    </button>
                                </div>

                                <!-- Sistem İstatistikleri -->
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-gray-700 mb-3">Sistem İstatistikleri</h4>
                                    <div id="system-stats-container" class="grid grid-cols-2 gap-3 text-sm">
                                        <div>
                                            <div class="text-gray-600">Toplam Bina</div>
                                            <div id="stat-buildings" class="text-lg font-bold text-blue-600">-</div>
                                        </div>
                                        <div>
                                            <div class="text-gray-600">Toplam Müşteri</div>
                                            <div id="stat-customers" class="text-lg font-bold text-green-600">-</div>
                                        </div>
                                        <div>
                                            <div class="text-gray-600">Blockchain Kayıt</div>
                                            <div id="stat-blockchain" class="text-lg font-bold text-purple-600">-</div>
                                        </div>
                                        <div>
                                            <div class="text-gray-600">Toplam Prim</div>
                                            <div id="stat-premium" class="text-lg font-bold text-orange-600">-</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Eğitim Durumu -->
                                <div id="training-status" class="hidden">
                                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                                        <div class="flex items-center">
                                            <i class="fas fa-spinner fa-spin text-yellow-600 mr-3"></i>
                                            <div>
                                                <p class="font-medium text-yellow-800">Model Eğitimi Devam Ediyor...</p>
                                                <p class="text-sm text-yellow-700">Bu işlem 2-5 dakika sürebilir. Lütfen bekleyiniz.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-right">
                            <button class="bg-primary hover:bg-primary-dark text-white font-bold py-2 px-6 rounded-lg transition-colors">
                                <i class="fas fa-save mr-2"></i>Tüm Ayarları Kaydet
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- DATA SIMULATION ---
        const policyData = [{
            no: 'DP25001',
            musteri: 'Ahmet Yılmaz',
            email: 'ahmet@email.com',
            tel: '0532 xxx xx01',
            adres: 'İstanbul/Kadıköy',
            teminat: '75,000 TL',
            prim: 680,
            baslangic: '2025-01-15',
            durum: 'Aktif'
        }, {
            no: 'DP25002',
            musteri: 'Ayşe Kaya',
            email: 'ayse@email.com',
            tel: '0533 xxx xx02',
            adres: 'İzmir/Bornova',
            teminat: '50,000 TL',
            prim: 520,
            baslangic: '2025-02-10',
            durum: 'Aktif'
        }, {
            no: 'DP25003',
            musteri: 'Mehmet Öztürk',
            email: 'mehmet@email.com',
            tel: '0534 xxx xx03',
            adres: 'Ankara/Çankaya',
            teminat: '25,000 TL',
            prim: 310,
            baslangic: '2025-01-20',
            durum: 'Aktif'
        }, {
            no: 'DP25004',
            musteri: 'Fatma Demir',
            email: 'fatma@email.com',
            tel: '0535 xxx xx04',
            adres: 'Bursa/Nilüfer',
            teminat: '50,000 TL',
            prim: 450,
            baslangic: '2025-03-01',
            durum: 'Beklemede'
        }, {
            no: 'DP25005',
            musteri: 'Ali Can',
            email: 'ali@email.com',
            tel: '0536 xxx xx05',
            adres: 'İstanbul/Fatih',
            teminat: '75,000 TL',
            prim: 820,
            baslangic: '2024-12-05',
            durum: 'Aktif'
        }, {
            no: 'DP25006',
            musteri: 'Zeynep Şahin',
            email: 'zeynep@email.com',
            tel: '0537 xxx xx06',
            adres: 'İzmir/Çeşme',
            teminat: '75,000 TL',
            prim: 610,
            baslangic: '2024-11-20',
            durum: 'Süresi Doldu'
        }, ];

        const claimsData = [{
            hasarNo: 'H25001',
            policeNo: 'DP25001',
            musteri: 'Ahmet Yılmaz',
            depremTarih: '2025-10-08',
            pgv: '35.2 cm/s',
            tutar: '75,000 TL',
            durum: 'Ödendi'
        }, {
            hasarNo: 'H25002',
            policeNo: 'DP25003',
            musteri: 'Mehmet Öztürk',
            depremTarih: '2025-10-08',
            pgv: '42.8 cm/s',
            tutar: '25,000 TL',
            durum: 'Beklemede'
        }, {
            hasarNo: 'H25003',
            policeNo: 'DP25005',
            musteri: 'Ali Can',
            depremTarih: '2025-10-07',
            pgv: '31.5 cm/s',
            tutar: '75,000 TL',
            durum: 'İşlemde'
        }, ];

        const customersData = [{
            id: 'C001',
            name: 'Ahmet Yılmaz',
            email: 'ahmet@email.com',
            tel: '0532 xxx xx01',
            policeCount: 1,
            kayitTarih: '2025-01-15'
        }, {
            id: 'C002',
            name: 'Ayşe Kaya',
            email: 'ayse@email.com',
            tel: '0533 xxx xx02',
            policeCount: 1,
            kayitTarih: '2025-02-10'
        }, {
            id: 'C003',
            name: 'Mehmet Öztürk',
            email: 'mehmet@email.com',
            tel: '0534 xxx xx03',
            policeCount: 2,
            kayitTarih: '2025-01-20'
        }, ];

        const paymentsData = [{
            id: 'PAY001',
            policeNo: 'DP25001',
            musteri: 'Ahmet Yılmaz',
            tutar: '75,000 TL',
            tarih: '2025-10-09 14:30',
            durum: 'Tamamlandı'
        }, {
            id: 'PAY002',
            policeNo: 'DP25003',
            musteri: 'Mehmet Öztürk',
            tutar: '25,000 TL',
            tarih: '2025-10-09 10:15',
            durum: 'Beklemede'
        }, {
            id: 'PAY003',
            policeNo: 'DP25005',
            musteri: 'Ali Can',
            tutar: '75,000 TL',
            tarih: '2025-10-08 16:45',
            durum: 'İşlemde'
        }, ];

        const notificationsData = [{
            type: 'danger',
            icon: 'exclamation-triangle',
            title: 'Yüksek PGV Tespit Edildi',
            message: 'İstanbul/Kadıköy bölgesinde 35.2 cm/s PGV kaydedildi. 3 poliçe tetiklendi.',
            time: '5 dakika önce'
        }, {
            type: 'warning',
            icon: 'clock',
            title: 'Bekleyen Ödeme Onayı',
            message: '2 adet ödeme işlemi manuel onay bekliyor.',
            time: '1 saat önce'
        }, {
            type: 'success',
            icon: 'check-circle',
            title: 'Ödeme Tamamlandı',
            message: 'DP25001 numaralı poliçe için 75,000 TL ödeme başarıyla gerçekleşti.',
            time: '2 saat önce'
        }, {
            type: 'info',
            icon: 'info-circle',
            title: 'Sistem Güncellemesi',
            message: 'Kandilli API versiyonu güncellendi.',
            time: '3 saat önce'
        }, ];

        const auditData = [{
            tarih: '2025-10-09 14:30:22',
            kullanici: 'admin',
            islem: 'Ödeme Onayı',
            detay: 'DP25001 - 75,000 TL ödeme onaylandı',
            ip: '192.168.1.100'
        }, {
            tarih: '2025-10-09 12:15:33',
            kullanici: 'admin',
            islem: 'Poliçe Düzenleme',
            detay: 'DP25004 poliçesi güncellendi',
            ip: '192.168.1.100'
        }, {
            tarih: '2025-10-09 10:05:11',
            kullanici: 'operator1',
            islem: 'Müşteri Kaydı',
            detay: 'Yeni müşteri eklendi: Zeynep Demir',
            ip: '192.168.1.105'
        }, ];

        const pgvLocations = [{
            name: 'İstanbul',
            value: 8.2,
            threshold: 20
        }, {
            name: 'İzmir',
            value: 12.4,
            threshold: 20
        }, {
            name: 'Bursa',
            value: 6.1,
            threshold: 30
        }, {
            name: 'Ankara',
            value: 3.5,
            threshold: 40
        }, {
            name: 'Tokat',
            value: 5.2,
            threshold: 30
        }, ];

        const recentActivitiesData = [{
            icon: 'file-alt',
            color: 'blue',
            text: 'Yeni poliçe oluşturuldu: DP25007',
            time: '10 dakika önce'
        }, {
            icon: 'money-bill-wave',
            color: 'green',
            text: 'Ödeme tamamlandı: DP25001 - 75,000 TL',
            time: '25 dakika önce'
        }, {
            icon: 'exclamation-triangle',
            color: 'red',
            text: 'Yüksek PGV tespit edildi: İstanbul/Kadıköy - 35.2 cm/s',
            time: '1 saat önce'
        }, {
            icon: 'user-plus',
            color: 'purple',
            text: 'Yeni müşteri kaydı: Zeynep Demir',
            time: '2 saat önce'
        }, {
            icon: 'edit',
            color: 'orange',
            text: 'Poliçe güncellendi: DP25004',
            time: '3 saat önce'
        }, ];

        // --- UI & NAVIGATION ---
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.section');
        const pageTitle = document.getElementById('page-title');

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1) + '-section';

                sections.forEach(s => s.classList.add('hidden'));
                document.getElementById(targetId).classList.remove('hidden');

                navLinks.forEach(l => l.classList.remove('bg-primary'));
                link.classList.add('bg-primary');

                pageTitle.textContent = link.textContent.trim().replace(/\d+/g, '').trim();
            });
        });

        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('sidebar-hidden');
        });

        // --- DASHBOARD LOGIC ---
        function renderCharts() {
            // Policy Growth Chart
            new Chart(document.getElementById('policyGrowthChart'), {
                type: 'line',
                data: {
                    labels: ['Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül'],
                    datasets: [{
                        label: 'Aktif Poliçe Sayısı',
                        data: [850, 910, 980, 1050, 1150, 1247],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true
                        }
                    }
                }
            });

            // Risk Distribution Chart
            new Chart(document.getElementById('riskDistributionChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Yüksek Risk', 'Orta Risk', 'Düşük Risk'],
                    datasets: [{
                        data: [315, 582, 350],
                        backgroundColor: ['#dc2626', '#f59e0b', '#10b981'],
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updatePGVMonitor() {
            const container = document.getElementById('pgv-monitor');
            container.innerHTML = '';
            pgvLocations.forEach(loc => {
                loc.value += (Math.random() - 0.5) * 0.5;
                if (loc.value < 2) loc.value = 2;

                let colorClass = 'text-green-600';
                let bgClass = 'bg-green-50';
                if (loc.value > loc.threshold) {
                    colorClass = 'text-red-600 font-bold';
                    bgClass = 'bg-red-50 pulse-red';
                } else if (loc.value > loc.threshold * 0.8) {
                    colorClass = 'text-yellow-600';
                    bgClass = 'bg-yellow-50';
                }

                container.innerHTML += `
                    <div class="flex items-center justify-between p-3 ${bgClass} rounded-lg transition-all">
                        <span class="text-sm font-medium text-gray-800">${loc.name}</span>
                        <div class="text-right">
                            <span class="text-sm ${colorClass}">${loc.value.toFixed(1)} cm/s</span>
                            <p class="text-xs text-gray-500">Eşik: ${loc.threshold} cm/s</p>
                        </div>
                    </div>
                `;
            });
        }

        function updateCustomerStats() {
            // Müşteri sayısını API'den çek ve güncelle
            fetch('/api/customers')
                .then(response => response.json())
                .then(apiResponse => {
                    if (apiResponse.success && apiResponse.data) {
                        const totalCustomers = apiResponse.data.length;
                        const statElement = document.getElementById('stat-total-customers');
                        if (statElement) {
                            statElement.textContent = totalCustomers.toLocaleString('tr-TR');
                        }
                    }
                })
                .catch(error => console.error('Müşteri istatistikleri hatası:', error));
        }

        async function updateEarthquakeFeed() {
            const container = document.getElementById('earthquake-feed');

            try {
                // Flask backend API'den veri çek
                const response = await fetch('/api/earthquakes?min_magnitude=2.0&limit=10');
                const apiResponse = await response.json();
                if (apiResponse.success && apiResponse.data && apiResponse.data.length > 0) {
                    // Container'ı temizle ve yeni verileri ekle
                    container.innerHTML = '';

                    // API'den gelen verileri işle
                    apiResponse.data.forEach(eq => {
                        let magnitudeColor = 'text-green-600';
                        if (eq.magnitude >= 4.0) magnitudeColor = 'text-orange-600';
                        if (eq.magnitude >= 5.0) magnitudeColor = 'text-red-600';

                        const earthquakeHTML = `
                            <div class="flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                                <i class="fas fa-wave-square text-blue-500 mt-1"></i>
                                <div class="flex-1">
                                    <p class="text-sm font-semibold text-gray-800">${eq.location}</p>
                                    <p class="text-xs text-gray-500">
                                        Büyüklük: <span class="${magnitudeColor} font-semibold">${eq.magnitude} ML</span> | 
                                        Derinlik: ${eq.depth} km
                                    </p>
                                    <p class="text-xs text-gray-400">${eq.date} ${eq.time}</p>
                                </div>
                            </div>
                        `;
                        container.innerHTML += earthquakeHTML;
                    });

                    // Başlık durumunu güncelle
                    updateEarthquakeHeader('success', apiResponse.count);

                } else {
                    // API başarısız oldu, fallback veri göster
                    showFallbackEarthquakeData(container);
                    updateEarthquakeHeader('fallback', apiResponse.message || 'Veri alınamadı');
                }

            } catch (error) {
                console.error('Backend API hatası:', error);
                // Hata durumunda fallback veri göster
                showFallbackEarthquakeData(container);
                updateEarthquakeHeader('error', 'Backend bağlantı hatası');
            }
        }

        function updateEarthquakeHeader(status, info) {
            const headerElement = document.querySelector('#earthquake-feed').closest('.bg-white').querySelector('.flex.justify-between span');

            if (status === 'success') {
                headerElement.innerHTML = `
                    <i class="fas fa-satellite-dish mr-1"></i>Kandilli Canlı Veri (${info} deprem)
                `;
                headerElement.className = 'text-xs text-green-600 bg-green-50 px-2 py-1 rounded-full';
            } else if (status === 'fallback') {
                headerElement.innerHTML = `
                    <i class="fas fa-exclamation-triangle mr-1"></i>Fallback Veri
                `;
                headerElement.className = 'text-xs text-yellow-600 bg-yellow-50 px-2 py-1 rounded-full';
            } else {
                headerElement.innerHTML = `
                    <i class="fas fa-times-circle mr-1"></i>Bağlantı Hatası
                `;
                headerElement.className = 'text-xs text-red-600 bg-red-50 px-2 py-1 rounded-full';
            }
        }

        function showFallbackEarthquakeData(container) {
            // Kandilli verisi alınamazsa örnek veri göster
            const fallbackData = [{
                location: 'Ege Denizi',
                magnitude: 3.2,
                depth: 7,
                date: '2025.10.12',
                time: '14:30:45'
            }, {
                location: 'Marmara Denizi',
                magnitude: 2.8,
                depth: 12,
                date: '2025.10.12',
                time: '13:15:22'
            }, {
                location: 'Akdeniz',
                magnitude: 3.5,
                depth: 15,
                date: '2025.10.12',
                time: '12:45:10'
            }, {
                location: 'Kahramanmaraş',
                magnitude: 2.4,
                depth: 8,
                date: '2025.10.12',
                time: '11:20:33'
            }, {
                location: 'Van',
                magnitude: 2.9,
                depth: 18,
                date: '2025.10.12',
                time: '10:55:17'
            }];

            container.innerHTML = '<div class="text-xs text-yellow-600 p-2 mb-2 bg-yellow-50 rounded">Canlı veri alınamadı, örnek veri gösteriliyor</div>';

            fallbackData.forEach(eq => {
                let magnitudeColor = 'text-green-600';
                if (eq.magnitude >= 4.0) magnitudeColor = 'text-orange-600';
                if (eq.magnitude >= 5.0) magnitudeColor = 'text-red-600';

                container.innerHTML += `
                    <div class="flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-wave-square text-blue-500 mt-1"></i>
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-800">${eq.location}</p>
                            <p class="text-xs text-gray-500">
                                Büyüklük: <span class="${magnitudeColor} font-semibold">${eq.magnitude} ML</span> | 
                                Derinlik: ${eq.depth} km
                            </p>
                            <p class="text-xs text-gray-400">${eq.date} ${eq.time}</p>
                        </div>
                    </div>
                `;
            });
        }

        function renderRecentActivities() {
            const container = document.getElementById('recentActivities');
            container.innerHTML = '';
            recentActivitiesData.forEach(activity => {
                const colorMap = {
                    blue: 'text-blue-600',
                    green: 'text-green-600',
                    red: 'text-red-600',
                    purple: 'text-purple-600',
                    orange: 'text-orange-600'
                };
                container.innerHTML += `
                    <div class="flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors">
                        <i class="fas fa-${activity.icon} ${colorMap[activity.color]} text-xl mt-1"></i>
                        <div class="flex-1">
                            <p class="text-sm text-gray-800">${activity.text}</p>
                            <p class="text-xs text-gray-500 mt-1">${activity.time}</p>
                        </div>
                    </div>
                `;
            });
        }

        // --- POLICY MANAGEMENT LOGIC ---
        const policyTableBody = document.getElementById('policyTableBody');
        const policySearch = document.getElementById('policySearch');
        const policyFilter = document.getElementById('policyFilter');

        // Pagination state for policies
        let currentPolicyPage = 1;
        let currentPolicyPerPage = 20;
        let currentPolicySearch = '';
        let currentPolicyFilter = 'all';
        let totalPolicyPages = 0;

        function createPolicySkeletonRow() {
            return `
                <tr class="animate-pulse">
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-24"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-32"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-40"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-24"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-16"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-24"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-16"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-24"></div></td>
                </tr>
            `;
        }

        function loadPoliciesPage(page = 1, perPage = 20, search = '', statusFilter = 'all') {
            const tbody = document.getElementById('policyTableBody');

            // Skeleton loading göster
            let skeletonHTML = '';
            for (let i = 0; i < Math.min(perPage, 5); i++) {
                skeletonHTML += createPolicySkeletonRow();
            }
            tbody.innerHTML = skeletonHTML;

            // API isteği parametreleri
            const params = new URLSearchParams({
                page: page,
                per_page: perPage,
                search: search,
                status: statusFilter
            });

            // Backend API'den poliçe verisi çek
            fetch(`/api/policies?${params.toString()}`)
                .then(response => response.json())
                .then(apiResponse => {
                    tbody.innerHTML = '';

                    if (apiResponse.success && apiResponse.data && apiResponse.data.length > 0) {
                        // State güncelle
                        currentPolicyPage = page;
                        currentPolicyPerPage = perPage;
                        currentPolicySearch = search;
                        currentPolicyFilter = statusFilter;
                        totalPolicyPages = apiResponse.total_pages;

                        // Tablo satırlarını render et
                        apiResponse.data.forEach(p => {
                            let statusClass = '';
                            if (p.durum === 'Aktif') statusClass = 'bg-green-100 text-green-800';
                            else if (p.durum === 'Beklemede') statusClass = 'bg-yellow-100 text-yellow-800';
                            else statusClass = 'bg-red-100 text-red-800';

                            tbody.innerHTML += `
                                <tr class="hover:bg-gray-50 transition-colors">
                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${p.no}</td>
                                    <td class="px-6 py-4 text-sm text-gray-800">${p.musteri}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">${p.adres}</td>
                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${p.teminat}</td>
                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">₺${p.prim}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">${p.baslangic}</td>
                                    <td class="px-6 py-4"><span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${p.durum}</span></td>
                                    <td class="px-6 py-4 text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2" title="Görüntüle"><i class="fas fa-eye"></i></button>
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Düzenle"><i class="fas fa-edit"></i></button>
                                        <button class="text-red-600 hover:text-red-800" title="Sil"><i class="fas fa-trash"></i></button>
                                    </td>
                                </tr>
                            `;
                        });

                        // Pagination UI'ını güncelle
                        updatePolicyPaginationUI(apiResponse);

                        // Toplam poliçe sayısını güncelle
                        document.getElementById('totalPolicies').textContent = apiResponse.total;
                    } else {
                        tbody.innerHTML = '<tr><td colspan="8" class="px-6 py-4 text-center text-sm text-gray-500">Poliçe verisi bulunamadı</td></tr>';
                        document.getElementById('totalPolicies').textContent = '0';
                    }
                })
                .catch(error => {
                    console.error('Poliçe listesi hatası:', error);
                    tbody.innerHTML = '<tr><td colspan="8" class="px-6 py-4 text-center text-sm text-red-600">API hatası: ' + error.message + '</td></tr>';
                });
        }

        function updatePolicyPaginationUI(apiResponse) {
            const prevBtn = document.getElementById('policyPrevPageBtn');
            const nextBtn = document.getElementById('policyNextPageBtn');
            const pageNumbersDiv = document.getElementById('policyPageNumbers');

            const page = apiResponse.page;
            const totalPages = apiResponse.total_pages;

            // Önceki buton durumu
            prevBtn.disabled = !apiResponse.has_prev;

            // Sonraki buton durumu
            nextBtn.disabled = !apiResponse.has_next;

            // Sayfa numaralarını oluştur (max 5 sayfa göster)
            pageNumbersDiv.innerHTML = '';
            let startPage = Math.max(1, page - 2);
            let endPage = Math.min(totalPages, startPage + 4);

            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }

            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = `px-2.5 py-1.5 rounded-md text-sm font-medium transition-colors ${
                    i === page 
                        ? 'bg-primary text-white' 
                        : 'border hover:bg-gray-50'
                }`;
                btn.onclick = () => loadPoliciesPage(i, currentPolicyPerPage, currentPolicySearch, currentPolicyFilter);
                pageNumbersDiv.appendChild(btn);
            }
        }

        function renderPolicyTable() {
            // İlk yükleme - sayfa 1, perPage 20
            loadPoliciesPage(1, 20, '', 'all');
        }

        // --- CLAIMS MANAGEMENT ---
        function renderClaimsTable() {
            const tbody = document.getElementById('claimsTableBody');
            tbody.innerHTML = '';
            claimsData.forEach(claim => {
                let statusClass = '';
                if (claim.durum === 'Ödendi') statusClass = 'bg-green-100 text-green-800';
                else if (claim.durum === 'Beklemede') statusClass = 'bg-yellow-100 text-yellow-800';
                else statusClass = 'bg-blue-100 text-blue-800';

                tbody.innerHTML += `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${claim.hasarNo}</td>
                        <td class="px-6 py-4 text-sm text-gray-800">${claim.policeNo}</td>
                        <td class="px-6 py-4 text-sm text-gray-800">${claim.musteri}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${claim.depremTarih}</td>
                        <td class="px-6 py-4 text-sm font-bold text-red-600">${claim.pgv}</td>
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${claim.tutar}</td>
                        <td class="px-6 py-4"><span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${claim.durum}</span></td>
                        <td class="px-6 py-4 text-sm">
                            <button class="text-blue-600 hover:text-blue-800 mr-2" title="Detay"><i class="fas fa-info-circle"></i></button>
                            <button class="text-green-600 hover:text-green-800" title="Onayla"><i class="fas fa-check"></i></button>
                        </td>
                    </tr>
                `;
            });
        }

        // --- CUSTOMERS MANAGEMENT ---
        // Pagination state
        let currentPage = 1;
        let currentPerPage = 20;
        let currentSearch = '';
        let totalPages = 0;

        function createSkeletonRow() {
            return `
                <tr class="animate-pulse">
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-20"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-32"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-40"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-28"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-12"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-24"></div></td>
                    <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded w-16"></div></td>
                </tr>
            `;
        }

        function loadCustomersPage(page = 1, perPage = 20, search = '') {
            const tbody = document.getElementById('customersTableBody');

            // Skeleton loading göster
            let skeletonHTML = '';
            for (let i = 0; i < Math.min(perPage, 5); i++) {
                skeletonHTML += createSkeletonRow();
            }
            tbody.innerHTML = skeletonHTML;

            // API isteği parametreleri
            const params = new URLSearchParams({
                page: page,
                per_page: perPage,
                search: search
            });

            // Backend API'den müşteri verisi çek
            fetch(`/api/customers?${params.toString()}`)
                .then(response => response.json())
                .then(apiResponse => {
                    tbody.innerHTML = '';

                    if (apiResponse.success && apiResponse.data && apiResponse.data.length > 0) {
                        // State güncelle
                        currentPage = page;
                        currentPerPage = perPage;
                        currentSearch = search;
                        totalPages = apiResponse.total_pages;

                        // Tablo satırlarını render et
                        apiResponse.data.forEach(customer => {
                            tbody.innerHTML += `
                                <tr class="hover:bg-gray-50 transition-colors">
                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${customer.id}</td>
                                    <td class="px-6 py-4 text-sm text-gray-800">${customer.ad_soyad}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">${customer.email}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">${customer.telefon}</td>
                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${customer.police_sayisi}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">${customer.kayit_tarihi}</td>
                                    <td class="px-6 py-4 text-sm">
                                        <button onclick="openCustomerModal('${customer.id}')" class="text-blue-600 hover:text-blue-800 mr-2" title="Görüntüle"><i class="fas fa-eye"></i></button>
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Düzenle"><i class="fas fa-edit"></i></button>
                                        <button class="text-orange-600 hover:text-orange-800" title="Mesaj Gönder"><i class="fas fa-envelope"></i></button>
                                    </td>
                                </tr>
                            `;
                        });

                        // Pagination UI'ını güncelle
                        updatePaginationUI(apiResponse);

                        // Toplam müşteri sayısını güncelle
                        document.getElementById('totalCustomers').textContent = apiResponse.total;
                    } else {
                        tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-4 text-center text-sm text-gray-500">Müşteri verisi bulunamadı</td></tr>';
                        document.getElementById('totalCustomers').textContent = '0';
                    }
                })
                .catch(error => {
                    console.error('Müşteri listesi hatası:', error);
                    tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-4 text-center text-sm text-red-600">API hatası: ' + error.message + '</td></tr>';
                });
        }

        function updatePaginationUI(apiResponse) {
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            const pageNumbersDiv = document.getElementById('pageNumbers');

            const page = apiResponse.page;
            const totalPages = apiResponse.total_pages;

            // Önceki buton durumu
            prevBtn.disabled = !apiResponse.has_prev;

            // Sonraki buton durumu
            nextBtn.disabled = !apiResponse.has_next;

            // Sayfa numaralarını oluştur (max 5 sayfa göster)
            pageNumbersDiv.innerHTML = '';
            let startPage = Math.max(1, page - 2);
            let endPage = Math.min(totalPages, startPage + 4);

            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }

            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = `px-2.5 py-1.5 rounded-md text-sm font-medium transition-colors ${
                    i === page 
                        ? 'bg-primary text-white' 
                        : 'border hover:bg-gray-50'
                }`;
                btn.onclick = () => loadCustomersPage(i, currentPerPage, currentSearch);
                pageNumbersDiv.appendChild(btn);
            }
        }

        function renderCustomersTable() {
            // İlk yükleme - sayfa 1, perPage 20
            loadCustomersPage(1, 20, '');
        }

        // --- PAYMENTS ---
        function renderPaymentsTable() {
            const tbody = document.getElementById('paymentsTableBody');
            tbody.innerHTML = '';
            paymentsData.forEach(payment => {
                let statusClass = '';
                if (payment.durum === 'Tamamlandı') statusClass = 'bg-green-100 text-green-800';
                else if (payment.durum === 'Beklemede') statusClass = 'bg-yellow-100 text-yellow-800';
                else statusClass = 'bg-blue-100 text-blue-800';

                tbody.innerHTML += `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${payment.id}</td>
                        <td class="px-6 py-4 text-sm text-gray-800">${payment.policeNo}</td>
                        <td class="px-6 py-4 text-sm text-gray-800">${payment.musteri}</td>
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${payment.tutar}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${payment.tarih}</td>
                        <td class="px-6 py-4"><span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${payment.durum}</span></td>
                        <td class="px-6 py-4 text-sm">
                            <button class="text-blue-600 hover:text-blue-800 mr-2" title="Detay"><i class="fas fa-info-circle"></i></button>
                            <button class="text-red-600 hover:text-red-800" title="İptal"><i class="fas fa-times"></i></button>
                        </td>
                    </tr>
                `;
            });
        }

        // --- NOTIFICATIONS ---
        function renderNotifications() {
            const container = document.getElementById('notificationsList');
            container.innerHTML = '';
            notificationsData.forEach(notif => {
                const colorMap = {
                    danger: 'text-red-600 bg-red-50',
                    warning: 'text-yellow-600 bg-yellow-50',
                    success: 'text-green-600 bg-green-50',
                    info: 'text-blue-600 bg-blue-50'
                };
                container.innerHTML += `
                    <div class="p-4 hover:bg-gray-50 transition-colors">
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0 ${colorMap[notif.type]} p-2 rounded-full">
                                <i class="fas fa-${notif.icon}"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-semibold text-gray-900">${notif.title}</p>
                                <p class="text-sm text-gray-600 mt-1">${notif.message}</p>
                                <p class="text-xs text-gray-400 mt-2">${notif.time}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // --- AUDIT LOGS ---
        function renderAuditTable() {
            const tbody = document.getElementById('auditTableBody');
            tbody.innerHTML = '';
            auditData.forEach(log => {
                tbody.innerHTML += `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 text-sm text-gray-500">${log.tarih}</td>
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${log.kullanici}</td>
                        <td class="px-6 py-4 text-sm text-gray-800">${log.islem}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">${log.detay}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${log.ip}</td>
                    </tr>
                `;
            });
        }

        // --- EVENT LISTENERS ---

        // Poliçe pagination event listeners
        const policyPerPageSelect = document.getElementById('policyPerPageSelect');
        const policyPrevPageBtn = document.getElementById('policyPrevPageBtn');
        const policyNextPageBtn = document.getElementById('policyNextPageBtn');

        if (policyPerPageSelect) {
            policyPerPageSelect.addEventListener('change', (e) => {
                loadPoliciesPage(1, parseInt(e.target.value), currentPolicySearch, currentPolicyFilter);
            });
        }

        if (policySearch) {
            policySearch.addEventListener('input', (e) => {
                // Debounce arama (500ms)
                clearTimeout(window.policySearchTimeout);
                window.policySearchTimeout = setTimeout(() => {
                    loadPoliciesPage(1, currentPolicyPerPage, e.target.value, currentPolicyFilter);
                }, 500);
            });
        }

        if (policyFilter) {
            policyFilter.addEventListener('change', (e) => {
                loadPoliciesPage(1, currentPolicyPerPage, currentPolicySearch, e.target.value);
            });
        }

        if (policyPrevPageBtn) {
            policyPrevPageBtn.addEventListener('click', () => {
                if (currentPolicyPage > 1) {
                    loadPoliciesPage(currentPolicyPage - 1, currentPolicyPerPage, currentPolicySearch, currentPolicyFilter);
                }
            });
        }

        if (policyNextPageBtn) {
            policyNextPageBtn.addEventListener('click', () => {
                if (currentPolicyPage < totalPolicyPages) {
                    loadPoliciesPage(currentPolicyPage + 1, currentPolicyPerPage, currentPolicySearch, currentPolicyFilter);
                }
            });
        }

        // Müşteri pagination event listeners
        const perPageSelect = document.getElementById('perPageSelect');
        const customersSearch = document.getElementById('customersSearch');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');

        if (perPageSelect) {
            perPageSelect.addEventListener('change', (e) => {
                loadCustomersPage(1, parseInt(e.target.value), currentSearch);
            });
        }

        if (customersSearch) {
            customersSearch.addEventListener('input', (e) => {
                // Debounce arama (500ms)
                clearTimeout(window.customerSearchTimeout);
                window.customerSearchTimeout = setTimeout(() => {
                    loadCustomersPage(1, currentPerPage, e.target.value);
                }, 500);
            });
        }

        if (prevPageBtn) {
            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    loadCustomersPage(currentPage - 1, currentPerPage, currentSearch);
                }
            });
        }

        if (nextPageBtn) {
            nextPageBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    loadCustomersPage(currentPage + 1, currentPerPage, currentSearch);
                }
            });
        }

        // --- CUSTOMER DETAIL MODAL FUNCTIONS ---
        function openCustomerModal(customerId) {
            const modal = document.getElementById('customerDetailModal');
            modal.classList.remove('hidden');

            console.log('Müşteri modalı açılıyor, ID:', customerId);

            // Verileri yükle
            fetch(`/api/customers/${customerId}`)
                .then(response => {
                    console.log('Cevap alındı:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(result => {
                    console.log('JSON parse edildi:', result);

                    if (result.success && result.data) {
                        const customer = result.data;
                        console.log('Müşteri verisi:', customer);

                        try {
                            // Personal Info
                            const adSoyadEl = document.getElementById('modalAdSoyad');
                            if (adSoyadEl) adSoyadEl.textContent = customer.ad_soyad || '-';

                            const tcNoEl = document.getElementById('modalTcNo');
                            if (tcNoEl) tcNoEl.textContent = customer.tc_no || '-';

                            const emailEl = document.getElementById('modalEmail');
                            if (emailEl) emailEl.textContent = customer.email || '-';

                            const telefonEl = document.getElementById('modalTelefon');
                            if (telefonEl) telefonEl.textContent = customer.telefon || '-';

                            const ilceEl = document.getElementById('modalIlce');
                            if (ilceEl) ilceEl.textContent = customer.ilce || '-';

                            const semteEl = document.getElementById('modalSemte');
                            if (semteEl) semteEl.textContent = customer.semte || '-';

                            const tamAdresEl = document.getElementById('modalTamAdres');
                            if (tamAdresEl) tamAdresEl.textContent = customer.tam_adres || '-';

                            // Building Info
                            const yapiTipiEl = document.getElementById('modalYapiTipi');
                            if (yapiTipiEl) yapiTipiEl.textContent = customer.yapı_tipi || '-';

                            const insaYiliEl = document.getElementById('modalInsaYili');
                            if (insaYiliEl) insaYiliEl.textContent = customer.inşa_yili || '-';

                            const binaYasiEl = document.getElementById('modalBinaYasi');
                            if (binaYasiEl) binaYasiEl.textContent = customer.bina_yasi || '-';

                            const katSayisiEl = document.getElementById('modalKatSayisi');
                            if (katSayisiEl) katSayisiEl.textContent = customer.kat_sayisi || '-';

                            const daireSayisiEl = document.getElementById('modalDaireSayisi');
                            if (daireSayisiEl) daireSayisiEl.textContent = customer.daire_sayisi || '-';

                            const binaAlaniEl = document.getElementById('modalBinaAlani');
                            if (binaAlaniEl) binaAlaniEl.textContent = customer.bina_alani_m2 || '-';

                            // Risk Analysis
                            const zeminTipiEl = document.getElementById('modalZeminTipi');
                            if (zeminTipiEl) zeminTipiEl.textContent = customer.zemin_tipi || '-';

                            const zeminAmpEl = document.getElementById('modalZeminAmplifikasyonu');
                            if (zeminAmpEl) zeminAmpEl.textContent = customer.zemin_amplifikasyonu || '-';

                            const likefaksiyonEl = document.getElementById('modalLikefaksiyon');
                            if (likefaksiyonEl) likefaksiyonEl.textContent = customer.likefaksiyon_riski || '-';

                            const enYakinFayEl = document.getElementById('modalEnYakinFay');
                            if (enYakinFayEl) enYakinFayEl.textContent = customer.en_yakin_fay || '-';

                            const fayaUzaklikEl = document.getElementById('modalFayaUzaklik');
                            if (fayaUzaklikEl) fayaUzaklikEl.textContent = customer.faya_uzaklik_km || '-';

                            const riskSkoluEl = document.getElementById('modalRiskSkoru');
                            if (riskSkoluEl) riskSkoluEl.textContent = customer.risk_skoru || '-';

                            // Insurance Info
                            const paketTipiEl = document.getElementById('modalPaketTipi');
                            if (paketTipiEl) paketTipiEl.textContent = customer.paket_tipi || '-';

                            const maxTeminatEl = document.getElementById('modalMaxTeminat');
                            if (maxTeminatEl) maxTeminatEl.textContent = customer.max_teminat || '-';

                            const sigortaEl = document.getElementById('modalSigorta');
                            if (sigortaEl) sigortaEl.textContent = customer.sigorta_degeri_tl || '-';

                            const yillikPrimEl = document.getElementById('modalYillikPrim');
                            if (yillikPrimEl) yillikPrimEl.textContent = customer.yillik_prim_tl || '-';

                            const aylikPrimEl = document.getElementById('modalAylikPrim');
                            if (aylikPrimEl) aylikPrimEl.textContent = customer.aylik_prim_tl || '-';

                            const policyStatusEl = document.getElementById('modalPolicyStatus');
                            if (policyStatusEl) policyStatusEl.textContent = customer.policy_status || '-';

                            const kayitTarihiEl = document.getElementById('modalKayitTarihi');
                            if (kayitTarihiEl) kayitTarihiEl.textContent = customer.kayit_tarihi || '-';

                            console.log('Tüm alanlar dolduruldu!');
                        } catch (e) {
                            console.error('Alan doldurulurken hata:', e);
                        }
                    } else {
                        console.error('API başarısız:', result.message);
                        alert('Veriler yüklenemedi: ' + (result.message || 'Bilinmeyen hata'));
                        closeCustomerModal();
                    }
                })
                .catch(error => {
                    console.error('Müşteri detayları yüklenirken hata:', error);
                    alert('Müşteri bilgileri yüklenemedi: ' + error.message);
                    closeCustomerModal();
                });
        }

        function closeCustomerModal() {
            const modal = document.getElementById('customerDetailModal');
            modal.classList.add('hidden');
        }

        // --- AI MODEL MANAGEMENT ---
        async function loadModelInfo() {
            try {
                const response = await fetch('/api/admin/model-info');
                const result = await response.json();

                if (result.success && result.info) {
                    const info = result.info;

                    // Model durumu
                    const statusEl = document.getElementById('model-status');
                    if (info.model_exists) {
                        statusEl.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-1"></i>Aktif</span>';
                    } else {
                        statusEl.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-1"></i>Yok</span>';
                    }

                    // Son eğitim
                    if (info.last_trained) {
                        const date = new Date(info.last_trained);
                        document.getElementById('model-last-trained').textContent = date.toLocaleString('tr-TR');
                    }

                    // Performans metrikleri
                    if (info.performance) {
                        document.getElementById('model-r2').textContent = info.performance.r2_score || '-';
                        document.getElementById('model-rmse').textContent = info.performance.rmse || '-';
                    }

                    // Eğitim verileri
                    if (info.training_samples) {
                        document.getElementById('model-samples').textContent = info.training_samples.toLocaleString('tr-TR');
                    }
                }
            } catch (error) {
                console.error('Model bilgisi yüklenemedi:', error);
            }
        }

        async function loadSystemStats() {
            try {
                const response = await fetch('/api/admin/system-stats');
                const result = await response.json();

                if (result.success && result.stats) {
                    const stats = result.stats;

                    // Bina sayısı
                    if (stats.data_files.buildings) {
                        document.getElementById('stat-buildings').textContent =
                            stats.data_files.buildings.count.toLocaleString('tr-TR');
                    }

                    // Müşteri sayısı
                    if (stats.data_files.customers) {
                        document.getElementById('stat-customers').textContent =
                            stats.data_files.customers.count.toLocaleString('tr-TR');
                    }

                    // Blockchain kayıt
                    if (stats.blockchain) {
                        document.getElementById('stat-blockchain').textContent =
                            stats.blockchain.total_records.toLocaleString('tr-TR');
                    }

                    // Toplam prim
                    if (stats.data_files.buildings && stats.data_files.buildings.total_premium) {
                        const premium = stats.data_files.buildings.total_premium;
                        document.getElementById('stat-premium').textContent =
                            (premium / 1000000).toFixed(1) + 'M TL';
                    }
                }
            } catch (error) {
                console.error('Sistem istatistikleri yüklenemedi:', error);
            }
        }

        async function retrainModel() {
            const btn = document.getElementById('btn-retrain-model');
            const statusDiv = document.getElementById('training-status');

            // Onay al
            if (!confirm('Model yeniden eğitilecek. Bu işlem 2-5 dakika sürebilir. Devam etmek istiyor musunuz?')) {
                return;
            }

            // UI güncellemesi
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Eğitiliyor...';
            statusDiv.classList.remove('hidden');

            try {
                const response = await fetch('/api/admin/retrain-model', {
                    method: 'POST'
                });
                const result = await response.json();

                if (result.success) {
                    // Başarı mesajı
                    statusDiv.innerHTML = `
                        <div class="bg-green-50 border-l-4 border-green-400 p-4">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-600 mr-3 text-xl"></i>
                                <div>
                                    <p class="font-medium text-green-800">Model Başarıyla Eğitildi!</p>
                                    <p class="text-sm text-green-700">Süre: ${result.metrics.training_duration_seconds}s | 
                                       Veri: ${result.metrics.training_samples.toLocaleString('tr-TR')} kayıt</p>
                                </div>
                            </div>
                        </div>
                    `;

                    // Model bilgilerini yeniden yükle
                    setTimeout(() => {
                        loadModelInfo();
                        statusDiv.classList.add('hidden');
                    }, 5000);
                } else {
                    throw new Error(result.error || 'Model eğitimi başarısız');
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="bg-red-50 border-l-4 border-red-400 p-4">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-circle text-red-600 mr-3 text-xl"></i>
                            <div>
                                <p class="font-medium text-red-800">Hata Oluştu</p>
                                <p class="text-sm text-red-700">${error.message}</p>
                            </div>
                        </div>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-sync-alt mr-2"></i>Modeli Yeniden Eğit';
            }
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderCharts();
            updatePGVMonitor();
            updateCustomerStats();
            renderPolicyTable();
            renderClaimsTable();
            renderCustomersTable();
            renderPaymentsTable();
            renderNotifications();
            renderAuditTable();
            renderRecentActivities();

            // Model ve sistem bilgilerini yükle
            loadModelInfo();
            loadSystemStats();

            // İlk yüklemede deprem verilerini al
            updateEarthquakeFeed();

            setInterval(updatePGVMonitor, 3000);
            // Kandilli verilerini her 1 dakikada bir güncelle (çok sık istek atmamak için)
            setInterval(updateEarthquakeFeed, 60000);

            // Model bilgilerini periyodik güncelle (5 dakikada bir)
            setInterval(loadModelInfo, 300000);
            setInterval(loadSystemStats, 300000);

            // Modal kapatma butonu event listener
            const modalCloseBtn = document.querySelector('#customerDetailModal .fa-times');
            if (modalCloseBtn) {
                modalCloseBtn.parentElement.addEventListener('click', closeCustomerModal);
            }
        });
    </script>
</body>

</html>